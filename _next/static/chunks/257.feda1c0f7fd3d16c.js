(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[257],{1257:(t,a,e)=>{"use strict";e.r(a),e.d(a,{default:()=>l});var n=e(5155),r=e(2115),o=e(5645),i=e.n(o);let l=t=>{let{onImportSuccess:a,onImportError:e}=t,[o,l]=(0,r.useState)(!1),s=(0,r.useRef)(null),c=async t=>{var n;let r=null===(n=t.target.files)||void 0===n?void 0:n[0];if(r){l(!0);try{let t=await d(r),e=JSON.parse(t);if(!e.matchInfo||!e.players||!e.actions)throw Error("Nieprawidłowy format pliku. Brak wymaganych danych.");await p(e),a({players:e.players,actions:e.actions,matchInfo:e.matchInfo})}catch(t){console.error("Błąd importu:",t),e("Błąd importu: ".concat(t instanceof Error?t.message:String(t)))}finally{l(!1),s.current&&(s.current.value="")}}},d=t=>new Promise((a,e)=>{let n=new FileReader;n.onload=t=>{var n;(null===(n=t.target)||void 0===n?void 0:n.result)?a(t.target.result):e(Error("Nie udało się odczytać pliku"))},n.onerror=()=>e(Error("Błąd podczas odczytu pliku")),n.readAsText(t)}),p=async t=>{let a=t.matchInfo;a.matchId||(a.matchId=crypto.randomUUID()),await Promise.all([u(t.players,a),h(t.actions,a)])},u=async(t,a)=>{let e=await Promise.all(t.map(t=>fetch("/api/players?id=".concat(t.id)).then(t=>t.json())));for(let r=0;r<t.length;r++){var n;let o=t[r];((null===(n=e[r])||void 0===n?void 0:n.length)>0?e[r][0]:null)||await fetch("/api/players",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...o,teams:[a.team]})})}},h=async(t,a)=>{let e=new Set((await fetch("/api/actions?matchId=".concat(a.matchId)).then(t=>t.json())).map(t=>t.id)),n=t.filter(t=>!e.has(t.id));for(let t of n)await fetch("/api/actions",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...t,matchId:a.matchId})});return n.length};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("button",{className:i().importButton,onClick:()=>{s.current&&s.current.click()},disabled:o,title:"Importuj dane z pliku JSON",children:[(0,n.jsx)("span",{className:i().icon,children:o?"⏳":"\uD83D\uDCE5"}),o?"Importowanie...":"Importuj dane"]}),(0,n.jsx)("input",{ref:s,type:"file",accept:".json",onChange:c,style:{display:"none"}})]})}},5645:t=>{t.exports={importButton:"ImportButton_importButton__Vl3ah",icon:"ImportButton_icon__tsd_e"}}}]);